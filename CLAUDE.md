# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This repository contains the **Office JavaScript API reference documentation**. The documentation is **autogenerated** from TypeScript definition files (.d.ts) hosted on [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) and code snippets, then published to [Microsoft Learn](https://learn.microsoft.com/javascript/api/overview).

**Critical**: The `docs/docs-ref-autogen/` folder contains autogenerated content and should **NEVER** be manually edited. Changes to the documentation must be made to the source TypeScript definition files on DefinitelyTyped, not this repository.

## Documentation Generation Pipeline

The documentation generation follows a five-stage pipeline:

1. **Preprocessor** (`generate-docs/scripts/preprocessor.ts`) - Downloads d.ts files from DefinitelyTyped (or uses local files) and splits them into host-specific sections
2. **API Extractor** - Converts d.ts files into JSON data for parsing
3. **Midprocessor** (`generate-docs/scripts/midprocessor.ts`) - Consolidates code snippets from local files and Script Lab, pairs them with proper hosts, and handles crosslinking
4. **API Documenter** - Converts JSON to YAML files (standard version)
5. **Postprocessor** (`generate-docs/scripts/postprocessor.ts`) - Injects code snippets into YAML, maps API set URLs, cleans up table of contents, and moves YAML to `docs/docs-ref-autogen/`

**Note**: The repository uses the standard API Documenter (not the Office-specific fork). Office-specific features such as snippet injection and API set URL mapping are handled by the enhanced postprocessor.

## Build Commands

### Generate Documentation

```bash
cd generate-docs
./GenerateDocs.sh
```

When prompted, select the source for TypeScript definition files:
- **DefinitelyTyped (optimized rebuild)** - Default, only rebuilds if d.ts files changed
- **DefinitelyTyped (full rebuild)** - Forces complete rebuild
- **CDN (if available)** - Uses CDN-hosted definitions
- **Local files** - Uses files from `generate-docs/script-inputs/*.d.ts` (useful for testing changes before submitting to DefinitelyTyped)

For automated builds (bypasses prompt):
```bash
./GenerateDocs.sh -b DT
```

Build logs are written to `generate-docs/build-log.txt` and `generate-docs/build-errors.txt`.

### Build Scripts Only

```bash
cd generate-docs/scripts
npm install
npm run build      # Compile TypeScript to JavaScript
npm run start      # Watch mode for development
npm run lint       # Run ESLint
```

## Code Contributions

### Contributing Code Snippets

Code snippets appear in the reference documentation and come from two sources:

1. **Local snippets** - `docs/code-snippets/*-snippets.yaml`
   - Each YAML key is a UID in the format `<Application>.<ClassName>#<fieldName>:member<overloadNumber>`
   - Example: `Excel.Workbook#charts:member(1)`
   - Add or modify snippets directly in these files

2. **Script Lab samples** - [OfficeDev/office-js-snippets](https://github.com/OfficeDev/office-js-snippets)
   - For larger, working examples that users can run in Script Lab

### Testing Documentation Changes

To test changes to TypeScript definitions before submitting to DefinitelyTyped:

1. Edit the corresponding file in `generate-docs/script-inputs/`
2. Run `./GenerateDocs.sh` and select "Local files"
3. Review the generated documentation in `docs/docs-ref-autogen/`
4. Once satisfied, submit the changes to DefinitelyTyped

### Version Management

The repository maintains separate documentation for each API requirement set version:
- Excel: Versions 1.1 through 1.20, plus Online and Desktop variants
- Outlook: Versions 1.1 through 1.15
- Word: Versions 1.1 through 1.9, plus hidden document and desktop variants
- PowerPoint: Versions 1.1 through 1.10
- OneNote, Visio: Single versions

The `version-remover` tool (from `versioned-d.ts-tools` package) creates versioned d.ts files by progressively removing newer API sets.

## Repository Structure

```
office-js-docs-reference/
├── docs/
│   ├── docs-ref-autogen/        # AUTOGENERATED - Do not edit manually
│   │   ├── excel/               # Excel preview APIs
│   │   ├── excel_1_X/           # Excel versioned APIs
│   │   ├── outlook/             # Outlook APIs
│   │   ├── word/                # Word APIs
│   │   └── ...
│   ├── code-snippets/           # Local code snippets (editable)
│   │   ├── excel-snippets.yaml
│   │   ├── outlook-snippets.yaml
│   │   └── ...
│   ├── requirement-sets/        # Requirement set documentation
│   └── docfx.json               # DocFX configuration
└── generate-docs/
    ├── GenerateDocs.sh          # Main build script
    ├── configs/                 # Version configuration files
    ├── scripts/                 # Processing scripts (TypeScript)
    │   ├── preprocessor.ts      # Stage 1: Fetch and split d.ts files
    │   ├── midprocessor.ts      # Stage 3: Add snippets and crosslinks
    │   ├── postprocessor.ts     # Stage 5: Finalize output
    │   └── util.ts              # Shared utilities
    ├── api-extractor-inputs-*/  # Per-host d.ts file staging areas
    ├── script-inputs/           # Local d.ts files for testing
    ├── json/                    # API Extractor output (intermediate)
    └── yaml/                    # API Documenter output (intermediate)
```

## Key Files

- `DocumentationToolingNotes.md` - Detailed explanation of the documentation generation process
- `Contributing.md` - Contribution guidelines
- `generate-docs/coverage-report-exemptions.json` - API coverage exceptions
- `.openpublishing.publish.config.json` - Publishing configuration for Microsoft Learn

## Important Notes

### Do Not Edit Autogenerated Files

Files in `docs/docs-ref-autogen/` are completely regenerated on every build. Any manual edits will be lost. To make changes:
1. For API documentation changes → Edit the TypeScript definitions on DefinitelyTyped
2. For code snippet changes → Edit the YAML files in `docs/code-snippets/`

### Testing Before DefinitelyTyped PR

Always test documentation changes locally using the "Local files" option in `GenerateDocs.sh` before submitting a PR to DefinitelyTyped. This helps catch formatting issues and ensures the documentation renders correctly.

### API Coverage Testing

The build script runs `reference-coverage-tester` at the end to verify API coverage. Configuration is in `generate-docs/configs/reference-coverage-tester.json` with exemptions in `generate-docs/coverage-report-exemptions.json`.

## Working with Multiple Office Applications

Each Office application (Excel, Outlook, Word, PowerPoint, OneNote, Visio) has its own:
- API extractor input directory (`api-extractor-inputs-<app>/`)
- Config file(s) in `generate-docs/configs/`
- Output directory in `docs/docs-ref-autogen/`
- Code snippets file in `docs/code-snippets/`

The Common API (Office namespace) is shared across all applications and has both preview and release versions.
